name: Render Keepalive

on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Render API
        env:
          KEEPALIVE_URL: ${{ secrets.RENDER_KEEPALIVE_URL || vars.RENDER_KEEPALIVE_URL }}
        run: |
          if [ -z "$KEEPALIVE_URL" ]; then
            echo "RENDER_KEEPALIVE_URL is missing. Skip keepalive."
            exit 0
          fi

          HTTP_CODE=$(curl -sS -o /dev/null -w "%{http_code}" \
            --connect-timeout 10 \
            --max-time 20 \
            "$KEEPALIVE_URL")

          echo "HTTP status: $HTTP_CODE"

          # 5xx만 실패로 간주 (401/404도 서버 기동 확인 목적상 성공 처리)
          if [ "$HTTP_CODE" -ge 500 ]; then
            echo "Server responded with 5xx"
            exit 1
          fi
